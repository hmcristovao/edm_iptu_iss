name: üß™ Testes Pytest (CI/CD)

on:
  push:
    branches: [ "padronizacao" ]
  pull_request:
    branches: [ "padronizacao" ]
  workflow_dispatch:

jobs:
  build:
    name: üêç Testes Python ${{ matrix.python-version }}
    runs-on: ubuntu-latest

    strategy:
      matrix:
        python-version: [ '3.12' ]

    steps:
    - name: ‚¨áÔ∏è Checkout do Reposit√≥rio
      uses: actions/checkout@v4

    - name: üõ†Ô∏è Configurar Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}

    - name: üì¶ Instalar Ferramentas de Teste (Pytest, Pandas, Mock)
      run: |
        python -m pip install --upgrade pip
        # Se tiver requirements.txt use: pip install -r requirements.txt
        pip install pytest pandas mock

    - name: üß™ Executar Testes (debug + executar em src/test)
      run: |
        echo "=== Repo root ==="
        pwd
        echo "=== Lista top-level ==="
        ls -la

        echo "=== Encontrando arquivos de teste em src ==="
        find src -maxdepth 6 -type f \( -name 'test_*.py' -o -name '*_test.py' \) -print || true

        echo "=== Conte√∫do de src/test (se existir) ==="
        if [ -d src/test ]; then
          ls -la src/test || true
        else
          echo "Diret√≥rio src/test n√£o encontrado"
        fi

        echo "=== Pytest collect-only (apontando para src/test) ==="
        # collect-only retorna n√£o-zero se n√£o encontrar nada, ent√£o n√£o abortamos aqui
        pytest --collect-only -q src/test || true

        echo "=== Executando pytest em src/test ==="
        # Rodar testes diretamente no diret√≥rio de testes; sem || true para que o job falhe em caso de falha nos testes
        pytest -v --log-cli-level=INFO src/test