name: ğŸ§ª Testes Pytest (CI/CD)

on:
  push:
    branches: [ "padronizacao" ]
  pull_request:
    branches: [ "padronizacao" ]
  workflow_dispatch:

jobs:
  build:
    name: ğŸ Testes Python ${{ matrix.python-version }}
    runs-on: ubuntu-latest

    strategy:
      matrix:
        python-version: [ '3.12' ]

    steps:
    - name: â¬‡ï¸ Checkout do RepositÃ³rio
      uses: actions/checkout@v4

    - name: ğŸ› ï¸ Configurar Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}

    - name: ğŸ“¦ Instalar DependÃªncias
      run: |
        python -m pip install --upgrade pip
        # Importante: instalamos openpyxl para suporte a arquivos .xlsx no pandas
        pip install pytest pandas mock openpyxl
        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

    - name: ğŸ§ª Executar Testes
      run: |
        # Definimos o PYTHONPATH para incluir a raiz do repositÃ³rio
        # Isso permite que o comando 'from src.Saae import ...' funcione
        export PYTHONPATH=$PYTHONPATH:$(pwd)
        
        # Executamos usando 'python -m pytest' para garantir a resoluÃ§Ã£o correta dos mÃ³dulos
        python -m pytest src/test/anonimizador_test.py -v --log-cli-level=INFO
