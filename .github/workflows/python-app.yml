name: ğŸ§ª Testes Pytest (CI/CD)

on:
  push:
    branches: [ "padronizacao" ]
  pull_request:
    branches: [ "padronizacao" ]
  workflow_dispatch:

jobs:
  build: 
    name: ğŸ Testes Python ${{ matrix.python-version }}
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        python-version: [ '3.10', '3.11', '3.12' ]

    steps:
    - name: â¬‡ï¸ Checkout do RepositÃ³rio
      uses: actions/checkout@v4

    - name: ğŸ› ï¸ Configurar Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}
        cache: 'pip' # Agora que vimos que vocÃª TEM um requirements.txt, o cache vai funcionar!

    - name: ğŸ“¦ Instalar DependÃªncias
      run: |
        python -m pip install --upgrade pip
        # Instala do seu arquivo e garante as de teste
        pip install -r requirements.txt
        pip install pytest pandas mock openpyxl

    - name: ğŸ§ª Executar Testes
      run: |
        # Definimos o PYTHONPATH para que o 'src' seja encontrado
        export PYTHONPATH=$PYTHONPATH:$(pwd)
        # Rodamos via 'python -m pytest' para garantir a resoluÃ§Ã£o dos nomes de mÃ³dulos
        python -m pytest src/test/anonimizador_test.py -v --log-cli-level=INFO