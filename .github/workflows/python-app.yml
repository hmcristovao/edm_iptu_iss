name: ğŸ§ª Testes Pytest (CI/CD)

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    name: ğŸ Testes Python ${{ matrix.python-version }}
    runs-on: ubuntu-latest

    strategy:
      matrix:
        python-version: [ '3.12' ]

    steps:
    - name: â¬‡ï¸ Checkout do RepositÃ³rio
      uses: actions/checkout@v4

    - name: ğŸ› ï¸ Configurar Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}

    - name: ğŸ“¦ Instalar Ferramentas de Teste (Pytest, Pandas, Mock)
      run: |
        python -m pip install --upgrade pip
        # Se tiver requirements.txt use: pip install -r requirements.txt
        pip install pytest pandas mock

    - name: ğŸ§ª Executar Testes (debug + executar em src/test)
      run: |
        echo "=== Repo root ==="
        pwd
        echo "=== Lista top-level ==="
        ls -la

        echo "=== Encontrando arquivos de teste em src ==="
        find src -maxdepth 6 -type f \( -name 'test_*.py' -o -name '*_test.py' \) -print || true

        echo "=== ConteÃºdo de src/test (se existir) ==="
        if [ -d src/test ]; then
          ls -la src/test || true
        else
          echo "DiretÃ³rio src/test nÃ£o encontrado"
        fi

        echo "=== Pytest collect-only (apontando para src/test) ==="
        # collect-only retorna nÃ£o-zero se nÃ£o encontrar nada, entÃ£o nÃ£o abortamos aqui
        pytest --collect-only -q src/test || true

        echo "=== Executando pytest em src/test ==="
        # Rodar testes diretamente no diretÃ³rio de testes; sem || true para que o job falhe em caso de falha nos testes
        pytest -v --log-cli-level=INFO src/test
